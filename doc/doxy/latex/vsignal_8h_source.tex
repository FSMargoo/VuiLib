\hypertarget{vsignal_8h_source}{}\doxysection{vsignal.\+h}
\label{vsignal_8h_source}\index{G:/VueLib/vuilib-\/cmake/include/core/signal/vsignal.h@{G:/VueLib/vuilib-\/cmake/include/core/signal/vsignal.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// License(MIT)}}
\DoxyCodeLine{2 \textcolor{comment}{// Athuor: Margoo}}
\DoxyCodeLine{3 \textcolor{comment}{// This is the signal system in vuilib}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}../vbasiccore.h"{}}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <list>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 VLIB\_BEGIN\_NAMESPACE}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{keyword}{namespace }Core \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{template}<\textcolor{keyword}{class}... Type>}
\DoxyCodeLine{17 \textcolor{keyword}{class }\mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}} \{}
\DoxyCodeLine{18 \textcolor{keyword}{private}:}
\DoxyCodeLine{19     std::function<void(Type...)> call\_function;}
\DoxyCodeLine{20     \textcolor{keywordtype}{bool}                         be\_blocked = \textcolor{keyword}{false};}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{public}:}
\DoxyCodeLine{23     \textcolor{keyword}{explicit} \mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}(std::function<\textcolor{keywordtype}{void}(Type...)> function) \{}
\DoxyCodeLine{24         call\_function = function;}
\DoxyCodeLine{25     \}}
\DoxyCodeLine{26     \textcolor{keyword}{inline} std::function<void(Type...)>* get\_function() \{}
\DoxyCodeLine{27         \textcolor{keywordflow}{return} \&call\_function;}
\DoxyCodeLine{28     \}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     \textcolor{keywordtype}{bool} is\_block() \{}
\DoxyCodeLine{31         \textcolor{keywordflow}{return} be\_blocked;}
\DoxyCodeLine{32     \}}
\DoxyCodeLine{33     \textcolor{keywordtype}{void} set\_block(\textcolor{keywordtype}{bool} stats) \{}
\DoxyCodeLine{34         be\_blocked = stats;}
\DoxyCodeLine{35     \}}
\DoxyCodeLine{36 \};}
\DoxyCodeLine{37 \textcolor{keyword}{template}<\textcolor{keyword}{class}... Type>}
\DoxyCodeLine{38 \textcolor{keyword}{class }\mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}<Type...> \{}
\DoxyCodeLine{39 \textcolor{keyword}{public}:}
\DoxyCodeLine{40     \textcolor{keyword}{using }functional\_ptr = void(*)(Type...);}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{keyword}{private}:}
\DoxyCodeLine{43     functional\_ptr functional;}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{keyword}{public}:}
\DoxyCodeLine{46     \textcolor{keyword}{explicit} \mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional}}(functional\_ptr init\_function)}
\DoxyCodeLine{47         : \mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}<Type...>(std::function<void(Type...)>(init\_function)) \{}
\DoxyCodeLine{48         functional = init\_function;}
\DoxyCodeLine{49     \}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{keyword}{inline} functional\_ptr get\_raw\_function() \{}
\DoxyCodeLine{52         \textcolor{keywordflow}{return} functional;}
\DoxyCodeLine{53     \}}
\DoxyCodeLine{54 \};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{keyword}{template}<\textcolor{keyword}{class }ObjectType, \textcolor{keyword}{class}... Type>}
\DoxyCodeLine{57 \textcolor{keyword}{class }\mbox{\hyperlink{class_core_1_1connection}{connection}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}<Type ...> \{}
\DoxyCodeLine{58 \textcolor{keyword}{public}:}
\DoxyCodeLine{59     \textcolor{keyword}{using }object\_functional\_ptr = void (ObjectType::*)(Type ...);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{private}:}
\DoxyCodeLine{62     ObjectType* object\_ref;}
\DoxyCodeLine{63     object\_functional\_ptr object\_functional;}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{keyword}{public}:}
\DoxyCodeLine{66     \mbox{\hyperlink{class_core_1_1connection}{connection}}(ObjectType* \textcolor{keywordtype}{object}, object\_functional\_ptr functional)}
\DoxyCodeLine{67         : \mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}<Type...>([object, functional](Type... args) \{ (*\textcolor{keywordtype}{object}.*functional)(args...); \}) \{}
\DoxyCodeLine{68         object\_ref = object;}
\DoxyCodeLine{69         object\_functional = functional;}
\DoxyCodeLine{70     \}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \textcolor{keyword}{inline} \textcolor{keywordtype}{void}* get\_raw\_object() \{}
\DoxyCodeLine{73         \textcolor{keywordflow}{return} object\_ref;}
\DoxyCodeLine{74     \}}
\DoxyCodeLine{75     \textcolor{keyword}{inline} object\_functional\_ptr}
\DoxyCodeLine{76         get\_raw\_call() \{}
\DoxyCodeLine{77         \textcolor{keywordflow}{return} object\_functional;}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 \};}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keyword}{template}<\textcolor{keyword}{class}... Type>}
\DoxyCodeLine{82 \textcolor{keyword}{class }\mbox{\hyperlink{class_core_1_1_v_signal}{VSignal}} \{}
\DoxyCodeLine{83 \textcolor{keyword}{private}:}
\DoxyCodeLine{84     std::list<std::shared\_ptr<\mbox{\hyperlink{class_core_1_1connect__basic}{connect\_basic}}<Type...> > >}
\DoxyCodeLine{85         slots;}
\DoxyCodeLine{86 }
\DoxyCodeLine{87 \textcolor{keyword}{private}:}
\DoxyCodeLine{88     \textcolor{keywordtype}{void} \_operator(\textcolor{keywordtype}{void} (*functional)(Type...), \textcolor{keywordtype}{int} operator\_stage) \{}
\DoxyCodeLine{89         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iterator = slots.begin(); iterator != slots.end();) \{}
\DoxyCodeLine{90             \mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional}}<Type...>* connect\_function = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional}}<Type...\textcolor{keyword}{>}*>((*iterator).get());}
\DoxyCodeLine{91 }
\DoxyCodeLine{92             \textcolor{keywordflow}{if} (connect\_function-\/>get\_raw\_function() == functional) \{}
\DoxyCodeLine{93                 \textcolor{keywordflow}{switch} (operator\_stage) \{}
\DoxyCodeLine{94                 \textcolor{keywordflow}{case} 0: \{}
\DoxyCodeLine{95                     slots.erase(iterator++);}
\DoxyCodeLine{96 }
\DoxyCodeLine{97                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{98                 \}}
\DoxyCodeLine{99                 \textcolor{keywordflow}{case} 1: \{}
\DoxyCodeLine{100                     connect\_function-\/>set\_block(\textcolor{keyword}{true});}
\DoxyCodeLine{101 }
\DoxyCodeLine{102                     ++iterator;}
\DoxyCodeLine{103 }
\DoxyCodeLine{104                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{105                 \}}
\DoxyCodeLine{106                 \textcolor{keywordflow}{case} 2: \{}
\DoxyCodeLine{107                     connect\_function-\/>set\_block(\textcolor{keyword}{false});}
\DoxyCodeLine{108 }
\DoxyCodeLine{109                     ++iterator;}
\DoxyCodeLine{110 }
\DoxyCodeLine{111                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{112                 \}}
\DoxyCodeLine{113                 \}}
\DoxyCodeLine{114             \}}
\DoxyCodeLine{115             \textcolor{keywordflow}{else}}
\DoxyCodeLine{116             \{}
\DoxyCodeLine{117                 ++iterator;}
\DoxyCodeLine{118             \}}
\DoxyCodeLine{119         \}}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121     \textcolor{keyword}{template}<\textcolor{keyword}{class} ObjectType>}
\DoxyCodeLine{122     \textcolor{keywordtype}{void} \_operator(ObjectType* \textcolor{keywordtype}{object}, \textcolor{keywordtype}{void} (ObjectType::* object\_function)(Type...), \textcolor{keywordtype}{int} opreator\_stage) \{}
\DoxyCodeLine{123         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iterator = slots.begin(); iterator != slots.end(); ) \{}
\DoxyCodeLine{124             \textcolor{keywordflow}{if} (iterator-\/>get()-\/>is\_block() == \textcolor{keyword}{true}) \{}
\DoxyCodeLine{125                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{126             \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128             \mbox{\hyperlink{class_core_1_1connection}{connection}}<ObjectType, Type...>* connect = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_core_1_1connection}{connection}}<ObjectType, Type...\textcolor{keyword}{>}*>((*iterator).get());}
\DoxyCodeLine{129 }
\DoxyCodeLine{130             \textcolor{keywordflow}{if} (connect-\/>get\_raw\_call() == object\_function \&\&}
\DoxyCodeLine{131                 connect-\/>get\_raw\_object() == object) \{}
\DoxyCodeLine{132                 \textcolor{keywordflow}{switch} (opreator\_stage) \{}
\DoxyCodeLine{133                 \textcolor{keywordflow}{case} 0: \{}
\DoxyCodeLine{134                     slots.erase(iterator++);}
\DoxyCodeLine{135 }
\DoxyCodeLine{136                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{137                 \}}
\DoxyCodeLine{138                 \textcolor{keywordflow}{case} 1: \{}
\DoxyCodeLine{139                     connect-\/>set\_block(\textcolor{keyword}{true});}
\DoxyCodeLine{140 }
\DoxyCodeLine{141                     ++iterator;}
\DoxyCodeLine{142 }
\DoxyCodeLine{143                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{144                 \}}
\DoxyCodeLine{145                 \textcolor{keywordflow}{case} 2: \{}
\DoxyCodeLine{146                     connect-\/>set\_block(\textcolor{keyword}{false});}
\DoxyCodeLine{147 }
\DoxyCodeLine{148                     ++iterator;}
\DoxyCodeLine{149 }
\DoxyCodeLine{150                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{151                 \}}
\DoxyCodeLine{152                 \}}
\DoxyCodeLine{153             \}}
\DoxyCodeLine{154             \textcolor{keywordflow}{else}}
\DoxyCodeLine{155             \{}
\DoxyCodeLine{156                 ++iterator;}
\DoxyCodeLine{157             \}}
\DoxyCodeLine{158         \}}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 \textcolor{keyword}{public}:}
\DoxyCodeLine{162     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} Connect(\textcolor{keywordtype}{void} (*functional)(Type...)) \{}
\DoxyCodeLine{163         std::shared\_ptr<\mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional}}<Type...>> functional\_ptr}
\DoxyCodeLine{164         (\textcolor{keyword}{new} \mbox{\hyperlink{class_core_1_1connect__functional}{connect\_functional<Type...>}}(functional));}
\DoxyCodeLine{165         slots.push\_back(functional\_ptr);}
\DoxyCodeLine{166     \}}
\DoxyCodeLine{167     \textcolor{keyword}{template}<\textcolor{keyword}{class} ObjectType>}
\DoxyCodeLine{168     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} Connect(ObjectType* \textcolor{keywordtype}{object}, \textcolor{keywordtype}{void} (ObjectType::* functional)(Type...)) \{}
\DoxyCodeLine{169         std::shared\_ptr<\mbox{\hyperlink{class_core_1_1connection}{connection}}<ObjectType, Type...> > functional\_ptr}
\DoxyCodeLine{170         (\textcolor{keyword}{new} \mbox{\hyperlink{class_core_1_1connection}{connection<ObjectType, Type...>}}(\textcolor{keywordtype}{object}, functional));}
\DoxyCodeLine{171 }
\DoxyCodeLine{172         slots.push\_back(functional\_ptr);}
\DoxyCodeLine{173     \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} Disconnect(\textcolor{keywordtype}{void} (*functional)(Type...)) \{}
\DoxyCodeLine{176         \_operator(functional, 0);}
\DoxyCodeLine{177     \}}
\DoxyCodeLine{178     \textcolor{keyword}{template}<\textcolor{keyword}{class} ObjectType>}
\DoxyCodeLine{179     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} Disconnect(ObjectType* \textcolor{keywordtype}{object}, \textcolor{keywordtype}{void} (ObjectType::* functional)(Type...)) \{}
\DoxyCodeLine{180         \_operator(\textcolor{keywordtype}{object}, functional, 0);}
\DoxyCodeLine{181     \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183     \textcolor{keywordtype}{void} Block(\textcolor{keywordtype}{void} (*functional)(Type ...), \textcolor{keywordtype}{bool} block\_stats) \{}
\DoxyCodeLine{184         \_operator(functional, block\_stats ? 1 : 2);}
\DoxyCodeLine{185     \}}
\DoxyCodeLine{186     \textcolor{keyword}{template}<\textcolor{keyword}{class} ObjectType>}
\DoxyCodeLine{187     \textcolor{keywordtype}{void} Block(ObjectType* \textcolor{keywordtype}{object}, \textcolor{keywordtype}{void} (ObjectType::* functional)(Type ...), \textcolor{keywordtype}{bool} block\_stats) \{}
\DoxyCodeLine{188         \_operator(\textcolor{keywordtype}{object}, functional, block\_stats ? 1 : 2);}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     \textcolor{keywordtype}{void} Emit(Type... args) \{}
\DoxyCodeLine{192         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} iterator = slots.begin(); iterator != slots.end(); ++iterator) \{}
\DoxyCodeLine{193             \textcolor{keywordflow}{if} (iterator-\/>get()-\/>is\_block() == \textcolor{keyword}{true}) \{}
\DoxyCodeLine{194                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{195             \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197             \textcolor{keyword}{auto} call\_function = iterator-\/>get()-\/>get\_function();}
\DoxyCodeLine{198 }
\DoxyCodeLine{199             (*call\_function)(args...);}
\DoxyCodeLine{200         \}}
\DoxyCodeLine{201     \}}
\DoxyCodeLine{202 \};}
\DoxyCodeLine{203 }
\DoxyCodeLine{204 \}}
\DoxyCodeLine{205 }
\DoxyCodeLine{206 VLIB\_END\_NAMESPACE}

\end{DoxyCode}
